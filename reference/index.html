
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://rhettbull.github.io/CGMetadata/reference/">
      
      
        <link rel="prev" href="..">
      
      
        <link rel="next" href="../cli/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.7">
    
    
      
        <title>Reference - CGMetadata Docs</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.4b4a2bd9.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#reference" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="CGMetadata Docs" class="md-header__button md-logo" aria-label="CGMetadata Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            CGMetadata Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Reference
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="CGMetadata Docs" class="md-nav__button md-logo" aria-label="CGMetadata Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    CGMetadata Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Reference
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Reference
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#imagemetadata" class="md-nav__link">
    ImageMetadata
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgmetadata.ImageMetadata" class="md-nav__link">
    ImageMetadata
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgmetadata.ImageMetadata.exif" class="md-nav__link">
    exif
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgmetadata.ImageMetadata.gps" class="md-nav__link">
    gps
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgmetadata.ImageMetadata.iptc" class="md-nav__link">
    iptc
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgmetadata.ImageMetadata.properties" class="md-nav__link">
    properties
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgmetadata.ImageMetadata.tiff" class="md-nav__link">
    tiff
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgmetadata.ImageMetadata.xmp" class="md-nav__link">
    xmp
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgmetadata.ImageMetadata.__enter__" class="md-nav__link">
    __enter__()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgmetadata.ImageMetadata.__exit__" class="md-nav__link">
    __exit__()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgmetadata.ImageMetadata.asdict" class="md-nav__link">
    asdict()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgmetadata.ImageMetadata.reload" class="md-nav__link">
    reload()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgmetadata.ImageMetadata.set" class="md-nav__link">
    set()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgmetadata.ImageMetadata.write" class="md-nav__link">
    write()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgmetadata.ImageMetadata.xmp_dump" class="md-nav__link">
    xmp_dump()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgmetadata.ImageMetadata.xmp_dumps" class="md-nav__link">
    xmp_dumps()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgmetadata.ImageMetadata.xmp_load" class="md-nav__link">
    xmp_load()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgmetadata.ImageMetadata.xmp_loads" class="md-nav__link">
    xmp_loads()
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../cli/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Command Line Interface
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#imagemetadata" class="md-nav__link">
    ImageMetadata
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgmetadata.ImageMetadata" class="md-nav__link">
    ImageMetadata
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgmetadata.ImageMetadata.exif" class="md-nav__link">
    exif
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgmetadata.ImageMetadata.gps" class="md-nav__link">
    gps
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgmetadata.ImageMetadata.iptc" class="md-nav__link">
    iptc
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgmetadata.ImageMetadata.properties" class="md-nav__link">
    properties
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgmetadata.ImageMetadata.tiff" class="md-nav__link">
    tiff
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgmetadata.ImageMetadata.xmp" class="md-nav__link">
    xmp
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgmetadata.ImageMetadata.__enter__" class="md-nav__link">
    __enter__()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgmetadata.ImageMetadata.__exit__" class="md-nav__link">
    __exit__()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgmetadata.ImageMetadata.asdict" class="md-nav__link">
    asdict()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgmetadata.ImageMetadata.reload" class="md-nav__link">
    reload()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgmetadata.ImageMetadata.set" class="md-nav__link">
    set()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgmetadata.ImageMetadata.write" class="md-nav__link">
    write()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgmetadata.ImageMetadata.xmp_dump" class="md-nav__link">
    xmp_dump()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgmetadata.ImageMetadata.xmp_dumps" class="md-nav__link">
    xmp_dumps()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgmetadata.ImageMetadata.xmp_load" class="md-nav__link">
    xmp_load()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgmetadata.ImageMetadata.xmp_loads" class="md-nav__link">
    xmp_loads()
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="reference">Reference</h1>
<h2 id="imagemetadata">ImageMetadata</h2>


<div class="doc doc-object doc-class">



<a id="cgmetadata.ImageMetadata"></a>
  <div class="doc doc-contents first">

  
      <p>Read and write image metadata properties using native macOS APIs.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>filepath</code></td>
          <td>
                <code><span title="cgmetadata.types.FilePath">FilePath</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The path to the image file.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Raises:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>FileNotFoundError</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If the file does not exist.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td>
                <code>ValueError</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If the file is not an image file.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

            <details class="quote">
              <summary>Source code in <code>cgmetadata/classes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ImageMetadata</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Read and write image metadata properties using native macOS APIs.</span>

<span class="sd">    Args:</span>
<span class="sd">        filepath: The path to the image file.</span>

<span class="sd">    Raises:</span>
<span class="sd">        FileNotFoundError: If the file does not exist.</span>
<span class="sd">        ValueError: If the file is not an image file.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">:</span> <span class="n">FilePath</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filepath</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File not found: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_image</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Not an image file: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_context_manager</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_load</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">properties</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the metadata properties dictionary from the image.</span>

<span class="sd">        The dictionary keys are named &#39;IPTC&#39;, &#39;EXIF&#39;, etc.</span>
<span class="sd">        Some of the values are themselves dictionaries.</span>
<span class="sd">        For example, the &#39;IPTC&#39; value is a dictionary of IPTC metadata.</span>

<span class="sd">        Reference: https://developer.apple.com/documentation/imageio/image_properties?language=objc</span>
<span class="sd">        for more information.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># change keys to remove the leading &#39;{&#39; and trailing &#39;}&#39;</span>
        <span class="c1"># e.g. &#39;{IPTC}&#39; -&gt; &#39;IPTC&#39; but only if the key starts with &#39;{&#39;</span>
        <span class="c1"># also change Exif -&gt; EXIF, WebP -&gt; WEBP to match the other keys</span>
        <span class="n">properties</span> <span class="o">=</span> <span class="n">CFDictionary_to_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_properties</span><span class="p">)</span>
        <span class="n">properties</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;{&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="n">key</span><span class="p">:</span> <span class="n">value</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">properties</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="s2">&quot;Exif&quot;</span> <span class="ow">in</span> <span class="n">properties</span><span class="p">:</span>
            <span class="n">properties</span><span class="p">[</span><span class="s2">&quot;EXIF&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">properties</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;Exif&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;WebP&quot;</span> <span class="ow">in</span> <span class="n">properties</span><span class="p">:</span>
            <span class="n">properties</span><span class="p">[</span><span class="s2">&quot;WEBP&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">properties</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;WebP&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">properties</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">exif</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the EXIF properties dictionary from the image.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">EXIF</span><span class="p">,</span> <span class="p">{})</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">iptc</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the IPTC properties dictionary from the image.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">IPTC</span><span class="p">,</span> <span class="p">{})</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tiff</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the TIFF properties dictionary from the image.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">TIFF</span><span class="p">,</span> <span class="p">{})</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">gps</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the GPS properties dictionary from the image.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">GPS</span><span class="p">,</span> <span class="p">{})</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">xmp</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the XMP metadata dictionary for the image.</span>

<span class="sd">        The dictionary keys are in form &quot;prefix:name&quot;, e.g. &quot;dc:creator&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">metadata_dictionary_from_image_metadata_ref</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_metadata_ref</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">xmp_dumps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">header</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the serialized XMP metadata for the image.</span>

<span class="sd">        Args:</span>
<span class="sd">            header: If True, include the XMP packet header in the serialized XMP.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The serialized XMP metadata for the image as a string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">xmp</span> <span class="o">=</span> <span class="n">metadata_ref_serialize_xmp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_metadata_ref</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">header</span><span class="p">:</span>
            <span class="n">xmp</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">XMP_PACKET_HEADER</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">xmp</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">XMP_PACKET_FOOTER</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">xmp</span>

    <span class="k">def</span> <span class="nf">xmp_dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fp</span><span class="p">:</span> <span class="n">IO</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">header</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Write the serialized XMP metadata for the image to a file.</span>

<span class="sd">        Args:</span>
<span class="sd">            fp: The file pointer to write the XMP metadata to.</span>
<span class="sd">            header: If True, include the XMP packet header in the serialized XMP.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">xmp</span> <span class="o">=</span> <span class="n">metadata_ref_serialize_xmp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_metadata_ref</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">header</span><span class="p">:</span>
            <span class="n">xmp</span> <span class="o">=</span> <span class="n">XMP_PACKET_HEADER</span> <span class="o">+</span> <span class="n">xmp</span> <span class="o">+</span> <span class="n">XMP_PACKET_FOOTER</span>
        <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">xmp</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">xmp_loads</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xmp</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load XMP metadata from a string.</span>

<span class="sd">        Args:</span>
<span class="sd">            xmp: The XMP metadata as a string.</span>

<span class="sd">        Note:</span>
<span class="sd">            This does not write the metadata to the image file.</span>
<span class="sd">            Use write() to write the loaded metadata to the image file.</span>
<span class="sd">            The XMP standard allows quoted strings to use either single or double quotes.</span>
<span class="sd">            For example, exiftool uses single quotes. However, the native macOS APIs</span>
<span class="sd">            (CGImageMetadataCreateFromXMPData) returns nil if the XMP data contains single quotes.</span>
<span class="sd">            This does not appear to be documented anywhere in the Apple documentation.</span>
<span class="sd">            This function replaces single quotes with double quotes to avoid this issue.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xmp_set_from_str</span><span class="p">(</span><span class="n">xmp</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">xmp_load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fp</span><span class="p">:</span> <span class="n">IO</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load XMP metadata from a file.</span>

<span class="sd">        Args:</span>
<span class="sd">            fp: The file pointer to read the XMP metadata from.</span>

<span class="sd">        Note:</span>
<span class="sd">            This does not write the metadata to the image file.</span>
<span class="sd">            Use write() to write the loaded metadata to the image file.</span>
<span class="sd">            The XMP standard allows quoted strings to use either single or double quotes.</span>
<span class="sd">            For example, exiftool uses single quotes. However, the native macOS APIs</span>
<span class="sd">            (CGImageMetadataCreateFromXMPData) returns nil if the XMP data contains single quotes.</span>
<span class="sd">            This does not appear to be documented anywhere in the Apple documentation.</span>
<span class="sd">            This function replaces single quotes with double quotes to avoid this issue.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">xmp</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xmp_set_from_str</span><span class="p">(</span><span class="n">xmp</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">group</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;EXIF&quot;</span><span class="p">,</span> <span class="s2">&quot;IPTC&quot;</span><span class="p">,</span> <span class="s2">&quot;TIFF&quot;</span><span class="p">,</span> <span class="s2">&quot;GPS&quot;</span><span class="p">,</span> <span class="s2">&quot;XMP&quot;</span><span class="p">],</span>
        <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set a metadata property for the image.</span>

<span class="sd">        Args:</span>
<span class="sd">            group: The metadata group type to set the property for, for example, &quot;IPTC&quot;, &quot;XMP&quot;</span>
<span class="sd">            key: The key or key path of the metadata property to set;</span>
<span class="sd">                for &quot;XMP&quot; metadata, the key is in form &quot;prefix:name&quot;, e.g. &quot;dc:creator&quot;, &quot;dc:description&quot;...</span>
<span class="sd">                for other metadata, the key is the name of the property, e.g. &quot;LensModel&quot;, &quot;Make&quot;, &quot;Keywords&quot;...</span>
<span class="sd">            value: The value to set the metadata property to.</span>

<span class="sd">        Note:</span>
<span class="sd">            This does not write the metadata to the image file unless used in conjunction with the context manager.</span>
<span class="sd">            Use write() to write the metadata to the image file after setting one or more values.</span>
<span class="sd">            Metadata keys may be specified as a literal string, e.g. &quot;LensModel&quot; or using</span>
<span class="sd">            one of the constants from the ImageIO module, e.g. kCGImagePropertyExifLensModel,</span>
<span class="sd">            which are referenced here: https://developer.apple.com/documentation/imageio/exif_dictionary_keys</span>
<span class="sd">            These are available in the pyobjc Quartz module as Quartz.kCGImagePropertyExifLensModel, etc.</span>
<span class="sd">            You are responsible for passing the correct type of value for the metadata key,</span>
<span class="sd">            for example, str or list[str]. See https://github.com/adobe/xmp-docs/tree/master</span>
<span class="sd">            for more information on XMP metadata and expected types.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">group</span> <span class="o">==</span> <span class="n">XMP</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_metadata_ref</span> <span class="o">=</span> <span class="n">metadata_ref_set_tag_with_path</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_metadata_ref</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_metadata_ref</span> <span class="o">=</span> <span class="n">metadata_ref_set_tag_for_dict</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_metadata_ref</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Write the metadata to the image file then reloads the metadata from the image.&quot;&quot;&quot;</span>
        <span class="n">metadata_ref_write_to_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata_ref</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reload</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">reload</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reload the metadata from the image file.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_load</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">asdict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the metadata as a dictionary.&quot;&quot;&quot;</span>
        <span class="n">dict_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">dict_data</span><span class="p">[</span><span class="n">XMP</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmp</span>
        <span class="k">return</span> <span class="n">dict_data</span>

    <span class="k">def</span> <span class="nf">_load</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata_ref</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_properties</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="n">properties</span> <span class="o">=</span> <span class="n">load_image_properties</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_properties</span> <span class="o">=</span> <span class="n">properties</span><span class="o">.</span><span class="n">mutableCopy</span><span class="p">()</span>
        <span class="k">del</span> <span class="n">properties</span>

        <span class="n">metadata_ref</span> <span class="o">=</span> <span class="n">load_image_metadata_ref</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_metadata_ref</span> <span class="o">=</span> <span class="n">metadata_ref_create_mutable_copy</span><span class="p">(</span><span class="n">metadata_ref</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">metadata_ref</span>

    <span class="k">def</span> <span class="nf">_xmp_set_from_str</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xmp</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the XMP metadata from a string representing serialized XMP.&quot;&quot;&quot;</span>

        <span class="c1"># The Apple API requires that the XMP data use double quotes for quoted strings</span>
        <span class="c1"># and that the XMP data not contain the XMP packet headers</span>
        <span class="n">xmp</span> <span class="o">=</span> <span class="n">single_quotes_to_double_quotes</span><span class="p">(</span><span class="n">xmp</span><span class="p">)</span>
        <span class="n">xmp</span> <span class="o">=</span> <span class="n">strip_xmp_packet</span><span class="p">(</span><span class="n">xmp</span><span class="p">)</span>
        <span class="n">xmp</span> <span class="o">=</span> <span class="n">xmp</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xmp_set_from_bytes</span><span class="p">(</span><span class="n">xmp</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_xmp_set_from_bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xmp</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the XMP metadata from a bytes object representing serialized XMP.&quot;&quot;&quot;</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="n">metadata_ref_create_from_xmp</span><span class="p">(</span><span class="n">xmp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_metadata_ref</span> <span class="o">=</span> <span class="n">metadata_ref_create_mutable_copy</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">metadata</span>

    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Enter the context manager.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_context_manager</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Exit the context manager.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_context_manager</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reload</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_context_manager</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata_ref</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata_ref</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_properties</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_properties</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">




<h2 id="cgmetadata.ImageMetadata.exif" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">exif</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">
  
      <p>Return the EXIF properties dictionary from the image.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">




<h2 id="cgmetadata.ImageMetadata.gps" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">gps</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">
  
      <p>Return the GPS properties dictionary from the image.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">




<h2 id="cgmetadata.ImageMetadata.iptc" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">iptc</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">
  
      <p>Return the IPTC properties dictionary from the image.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">




<h2 id="cgmetadata.ImageMetadata.properties" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">properties</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">
  
      <p>Return the metadata properties dictionary from the image.</p>
<p>The dictionary keys are named 'IPTC', 'EXIF', etc.
Some of the values are themselves dictionaries.
For example, the 'IPTC' value is a dictionary of IPTC metadata.</p>
<p>Reference: https://developer.apple.com/documentation/imageio/image_properties?language=objc
for more information.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">




<h2 id="cgmetadata.ImageMetadata.tiff" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">tiff</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">
  
      <p>Return the TIFF properties dictionary from the image.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">




<h2 id="cgmetadata.ImageMetadata.xmp" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">xmp</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">
  
      <p>Return the XMP metadata dictionary for the image.</p>
<p>The dictionary keys are in form "prefix:name", e.g. "dc:creator".</p>
  </div>

</div>




<div class="doc doc-object doc-function">




<h2 id="cgmetadata.ImageMetadata.__enter__" class="doc doc-heading">
          <code class="highlight language-python"><span class="fm">__enter__</span><span class="p">()</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Enter the context manager.</p>

          <details class="quote">
            <summary>Source code in <code>cgmetadata/classes.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Enter the context manager.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_context_manager</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="cgmetadata.ImageMetadata.__exit__" class="doc doc-heading">
          <code class="highlight language-python"><span class="fm">__exit__</span><span class="p">(</span><span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Exit the context manager.</p>

          <details class="quote">
            <summary>Source code in <code>cgmetadata/classes.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Exit the context manager.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_context_manager</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reload</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_context_manager</span> <span class="o">=</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="cgmetadata.ImageMetadata.asdict" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">asdict</span><span class="p">()</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Return the metadata as a dictionary.</p>

          <details class="quote">
            <summary>Source code in <code>cgmetadata/classes.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">asdict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the metadata as a dictionary.&quot;&quot;&quot;</span>
    <span class="n">dict_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">dict_data</span><span class="p">[</span><span class="n">XMP</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmp</span>
    <span class="k">return</span> <span class="n">dict_data</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="cgmetadata.ImageMetadata.reload" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">reload</span><span class="p">()</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Reload the metadata from the image file.</p>

          <details class="quote">
            <summary>Source code in <code>cgmetadata/classes.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">reload</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reload the metadata from the image file.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_load</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="cgmetadata.ImageMetadata.set" class="doc doc-heading">
          <code class="highlight language-python"><span class="nb">set</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Set a metadata property for the image.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>group</code></td>
          <td>
                <code><span title="typing.Literal">Literal</span>[&#39;EXIF&#39;, &#39;IPTC&#39;, &#39;TIFF&#39;, &#39;GPS&#39;, &#39;XMP&#39;]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The metadata group type to set the property for, for example, "IPTC", "XMP"</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>key</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The key or key path of the metadata property to set;
for "XMP" metadata, the key is in form "prefix:name", e.g. "dc:creator", "dc:description"...
for other metadata, the key is the name of the property, e.g. "LensModel", "Make", "Keywords"...</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>value</code></td>
          <td>
                <code><span title="typing.Any">Any</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The value to set the metadata property to.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

<details class="note" open>
  <summary>Note</summary>
  <p>This does not write the metadata to the image file unless used in conjunction with the context manager.
Use write() to write the metadata to the image file after setting one or more values.
Metadata keys may be specified as a literal string, e.g. "LensModel" or using
one of the constants from the ImageIO module, e.g. kCGImagePropertyExifLensModel,
which are referenced here: https://developer.apple.com/documentation/imageio/exif_dictionary_keys
These are available in the pyobjc Quartz module as Quartz.kCGImagePropertyExifLensModel, etc.
You are responsible for passing the correct type of value for the metadata key,
for example, str or list[str]. See https://github.com/adobe/xmp-docs/tree/master
for more information on XMP metadata and expected types.</p>
</details>
          <details class="quote">
            <summary>Source code in <code>cgmetadata/classes.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">group</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;EXIF&quot;</span><span class="p">,</span> <span class="s2">&quot;IPTC&quot;</span><span class="p">,</span> <span class="s2">&quot;TIFF&quot;</span><span class="p">,</span> <span class="s2">&quot;GPS&quot;</span><span class="p">,</span> <span class="s2">&quot;XMP&quot;</span><span class="p">],</span>
    <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set a metadata property for the image.</span>

<span class="sd">    Args:</span>
<span class="sd">        group: The metadata group type to set the property for, for example, &quot;IPTC&quot;, &quot;XMP&quot;</span>
<span class="sd">        key: The key or key path of the metadata property to set;</span>
<span class="sd">            for &quot;XMP&quot; metadata, the key is in form &quot;prefix:name&quot;, e.g. &quot;dc:creator&quot;, &quot;dc:description&quot;...</span>
<span class="sd">            for other metadata, the key is the name of the property, e.g. &quot;LensModel&quot;, &quot;Make&quot;, &quot;Keywords&quot;...</span>
<span class="sd">        value: The value to set the metadata property to.</span>

<span class="sd">    Note:</span>
<span class="sd">        This does not write the metadata to the image file unless used in conjunction with the context manager.</span>
<span class="sd">        Use write() to write the metadata to the image file after setting one or more values.</span>
<span class="sd">        Metadata keys may be specified as a literal string, e.g. &quot;LensModel&quot; or using</span>
<span class="sd">        one of the constants from the ImageIO module, e.g. kCGImagePropertyExifLensModel,</span>
<span class="sd">        which are referenced here: https://developer.apple.com/documentation/imageio/exif_dictionary_keys</span>
<span class="sd">        These are available in the pyobjc Quartz module as Quartz.kCGImagePropertyExifLensModel, etc.</span>
<span class="sd">        You are responsible for passing the correct type of value for the metadata key,</span>
<span class="sd">        for example, str or list[str]. See https://github.com/adobe/xmp-docs/tree/master</span>
<span class="sd">        for more information on XMP metadata and expected types.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">group</span> <span class="o">==</span> <span class="n">XMP</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_metadata_ref</span> <span class="o">=</span> <span class="n">metadata_ref_set_tag_with_path</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_metadata_ref</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_metadata_ref</span> <span class="o">=</span> <span class="n">metadata_ref_set_tag_for_dict</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_metadata_ref</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="cgmetadata.ImageMetadata.write" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">write</span><span class="p">()</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Write the metadata to the image file then reloads the metadata from the image.</p>

          <details class="quote">
            <summary>Source code in <code>cgmetadata/classes.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Write the metadata to the image file then reloads the metadata from the image.&quot;&quot;&quot;</span>
    <span class="n">metadata_ref_write_to_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata_ref</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">reload</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="cgmetadata.ImageMetadata.xmp_dump" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">xmp_dump</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Write the serialized XMP metadata for the image to a file.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>fp</code></td>
          <td>
                <code><span title="typing.IO">IO</span>[str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The file pointer to write the XMP metadata to.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>header</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If True, include the XMP packet header in the serialized XMP.</p>
            </div>
          </td>
          <td>
                <code>True</code>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>cgmetadata/classes.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">xmp_dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fp</span><span class="p">:</span> <span class="n">IO</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">header</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Write the serialized XMP metadata for the image to a file.</span>

<span class="sd">    Args:</span>
<span class="sd">        fp: The file pointer to write the XMP metadata to.</span>
<span class="sd">        header: If True, include the XMP packet header in the serialized XMP.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">xmp</span> <span class="o">=</span> <span class="n">metadata_ref_serialize_xmp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_metadata_ref</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">header</span><span class="p">:</span>
        <span class="n">xmp</span> <span class="o">=</span> <span class="n">XMP_PACKET_HEADER</span> <span class="o">+</span> <span class="n">xmp</span> <span class="o">+</span> <span class="n">XMP_PACKET_FOOTER</span>
    <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">xmp</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="cgmetadata.ImageMetadata.xmp_dumps" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">xmp_dumps</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Return the serialized XMP metadata for the image.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>header</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If True, include the XMP packet header in the serialized XMP.</p>
            </div>
          </td>
          <td>
                <code>True</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The serialized XMP metadata for the image as a string.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>cgmetadata/classes.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">xmp_dumps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">header</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the serialized XMP metadata for the image.</span>

<span class="sd">    Args:</span>
<span class="sd">        header: If True, include the XMP packet header in the serialized XMP.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The serialized XMP metadata for the image as a string.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">xmp</span> <span class="o">=</span> <span class="n">metadata_ref_serialize_xmp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_metadata_ref</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">header</span><span class="p">:</span>
        <span class="n">xmp</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">XMP_PACKET_HEADER</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">xmp</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">XMP_PACKET_FOOTER</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">return</span> <span class="n">xmp</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="cgmetadata.ImageMetadata.xmp_load" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">xmp_load</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Load XMP metadata from a file.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>fp</code></td>
          <td>
                <code><span title="typing.IO">IO</span>[str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The file pointer to read the XMP metadata from.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

<details class="note" open>
  <summary>Note</summary>
  <p>This does not write the metadata to the image file.
Use write() to write the loaded metadata to the image file.
The XMP standard allows quoted strings to use either single or double quotes.
For example, exiftool uses single quotes. However, the native macOS APIs
(CGImageMetadataCreateFromXMPData) returns nil if the XMP data contains single quotes.
This does not appear to be documented anywhere in the Apple documentation.
This function replaces single quotes with double quotes to avoid this issue.</p>
</details>
          <details class="quote">
            <summary>Source code in <code>cgmetadata/classes.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">xmp_load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fp</span><span class="p">:</span> <span class="n">IO</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load XMP metadata from a file.</span>

<span class="sd">    Args:</span>
<span class="sd">        fp: The file pointer to read the XMP metadata from.</span>

<span class="sd">    Note:</span>
<span class="sd">        This does not write the metadata to the image file.</span>
<span class="sd">        Use write() to write the loaded metadata to the image file.</span>
<span class="sd">        The XMP standard allows quoted strings to use either single or double quotes.</span>
<span class="sd">        For example, exiftool uses single quotes. However, the native macOS APIs</span>
<span class="sd">        (CGImageMetadataCreateFromXMPData) returns nil if the XMP data contains single quotes.</span>
<span class="sd">        This does not appear to be documented anywhere in the Apple documentation.</span>
<span class="sd">        This function replaces single quotes with double quotes to avoid this issue.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">xmp</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_xmp_set_from_str</span><span class="p">(</span><span class="n">xmp</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="cgmetadata.ImageMetadata.xmp_loads" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">xmp_loads</span><span class="p">(</span><span class="n">xmp</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Load XMP metadata from a string.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>xmp</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The XMP metadata as a string.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

<details class="note" open>
  <summary>Note</summary>
  <p>This does not write the metadata to the image file.
Use write() to write the loaded metadata to the image file.
The XMP standard allows quoted strings to use either single or double quotes.
For example, exiftool uses single quotes. However, the native macOS APIs
(CGImageMetadataCreateFromXMPData) returns nil if the XMP data contains single quotes.
This does not appear to be documented anywhere in the Apple documentation.
This function replaces single quotes with double quotes to avoid this issue.</p>
</details>
          <details class="quote">
            <summary>Source code in <code>cgmetadata/classes.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">xmp_loads</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xmp</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load XMP metadata from a string.</span>

<span class="sd">    Args:</span>
<span class="sd">        xmp: The XMP metadata as a string.</span>

<span class="sd">    Note:</span>
<span class="sd">        This does not write the metadata to the image file.</span>
<span class="sd">        Use write() to write the loaded metadata to the image file.</span>
<span class="sd">        The XMP standard allows quoted strings to use either single or double quotes.</span>
<span class="sd">        For example, exiftool uses single quotes. However, the native macOS APIs</span>
<span class="sd">        (CGImageMetadataCreateFromXMPData) returns nil if the XMP data contains single quotes.</span>
<span class="sd">        This does not appear to be documented anywhere in the Apple documentation.</span>
<span class="sd">        This function replaces single quotes with double quotes to avoid this issue.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_xmp_set_from_str</span><span class="p">(</span><span class="n">xmp</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.aecac24b.min.js"></script>
      
    
  </body>
</html>